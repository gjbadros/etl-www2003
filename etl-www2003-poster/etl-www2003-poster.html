<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.2beta8 (1.46)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Extensible Templating Language: An XML-based Restricted Markup-Generating Language</TITLE>
<META NAME="description" CONTENT="The Extensible Templating Language: An XML-based Restricted Markup-Generating Language">
<META NAME="keywords" CONTENT="etl-www2003-poster">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.2beta8">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="etl-www2003-poster.css">

</HEAD>

<BODY >

<P>
1

<P>

<P>

<H1 ALIGN="CENTER">The Extensible Templating Language: 
<BR>       An XML-based Restricted Markup-Generating Language<BR></H1>
<P ALIGN="CENTER"><STRONG>Greg J. Badros, Abhishek Parmar
<BR>       InfoSpace, Inc., 601 108th Ave. NE, Suite 1200, Bellevue, WA 98004, USA
<BR>       </STRONG></P>
<P ALIGN="CENTER"><STRONG>17 February 2003</STRONG></P>
<P ALIGN="LEFT"><SMALL><A NAME="tex2html1"
  HREF="mailto:badros@cs.washington.edu, aparmar@infospace.com">badros@cs.washington.edu, aparmar@infospace.com</A></SMALL></P>
<BR>

<H3>Abstract:</H3>
<DIV>
 <FONT SIZE="-1">Unlike most popular web templating languages, the Extensible
Templating Language does not embed a general-purpose programming
language. Instead ETL <I>restricts</I> the set of language features, hence
limiting what can be done by templates and ensuring a better
separation of presentation from business logic. Furthermore,
ETL makes source templates easier to analyze by using an
XML-based representation where markup is intermingled with XML
elements corresponding to programming constructs. This approach helps
ensure proper markup and facilitates tool-building. ETL runs inside
of InfoSpace's ETL Server which serves millions of requests per
day. (A more thorough discussion of ETL is available
online.&nbsp;[<A
 HREF="etl-www2003-poster.html#ETL-full">2</A>])</FONT>

<P>
</DIV>
<P>

<P>
Restricted domain-specific programming language, static analysis,
web server, templates, XML, XSLT, markup, WML, HTML.

<P>

<H1><A NAME="SECTION00010000000000000000"></A>
<A NAME="sec-intro"></A><BR>
1 Introduction
</H1>

<P>
Server-side markup generation is dominated by expressive and
flexible general-purpose programming languages such as Java, Perl, and
PHP.  Ironically, the languages are then used in fairly
restricted ways. For example, consider the PHP template in
Fig.&nbsp;<A HREF="etl-www2003-poster.html#fig-php-books">1</A>.  The only constructs required by the template are
a) some means of populating a data model from the back-end business
logic (line 1); b) data-driven iteration (line 4); and c) simple
expression evaluation to access parts of the data model (lines 6 and
7). The extra power provided by typical templating languages not only
goes unused, but it also complicates analyses of the
code such as proving that processing terminates.

<P>

<P></P>
<DIV ALIGN="CENTER"><A NAME="fig-php-books"></A><A NAME="185"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 1:</STRONG>
Cleanly-written PHP templates require only the simplest
programming language constructs.  Because PHP is not markup-aware,
it does not catch the error on line 11.</CAPTION>
<TR><TD><IMG
 WIDTH="466" HEIGHT="155" BORDER="0"
 SRC="img1.png"
 ALT="\begin{figure}\renewcommand {\baselinestretch}{1}\small\listing {1}
&lt;? \$books =...
...
&lt;/table&gt;
&lt;/htm&gt;\renewcommand {\baselinestretch}{2}\endlisting \par\end{figure}"></TD></TR>
</TABLE>
</DIV><P></P>

<P>
Instead of embedding a general-purpose programming language, the
Extensible Templating Language<A NAME="tex2html3"
  HREF="#foot186"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]"
 SRC="file:/opt/lib/latex2html/icons/footnote.png"></SUP></A> is a domain-specific language
specifically tailored to the needs of generating markup.  This
approach limits the capabilities of the front-end and helps separate
front-end presentation from back-end application logic.  While other
languages might use an object-based data model to communicate between
tiers, ETL instead interacts only with web-services and exposes only
an XML data model.

<P>
Another problem with existing templating technologies is their mixing
of two separate programming paradigms and syntaxes.  JSP, for example,
is implemented in terms of a pre-processing rewrite into a Java
servlet. The precise analysis of an arbitrary JSP template necessarily
requires full knowledge of both the rewrite rules and the semantics of
Java.  Worse, templating languages generally are ignorant of the rules
of the markup being generated: the mistaken close tag on line 11 of
Fig.&nbsp;<A HREF="etl-www2003-poster.html#fig-php-books">1</A> goes unnoticed by PHP, yet will break under an XHTML browser.

<P>
To combat the above problem, ETL directly intermingles literal markup
elements and XML-based representations of programming
constructs.  By using XML as the surface
syntax, standard XML tools such as XSLT  can be used to perform
analyses and transformations&nbsp;[<A
 HREF="etl-www2003-poster.html#Badros-www9">1</A>].  An example ETL
template appears in Fig.&nbsp;<A HREF="etl-www2003-poster.html#fig-etl-books">2</A> and is analogous to the PHP
example from
Fig.&nbsp;<A HREF="etl-www2003-poster.html#fig-php-books">1</A>.

<P>

<P></P>
<DIV ALIGN="CENTER"><A NAME="fig-etl-books"></A><A NAME="187"></A>
<TABLE>
<CAPTION ALIGN="BOTTOM"><STRONG>Figure 2:</STRONG>
The ETL template corresponding to Fig.&nbsp;<A HREF="etl-www2003-poster.html#fig-php-books">1</A>'s PHP
code is required to be well-formed XML.  Thus, the developer
avoids the mistake from line 11 of the PHP example.</CAPTION>
<TR><TD><IMG
 WIDTH="490" HEIGHT="198" BORDER="0"
 SRC="img2.png"
 ALT="\begin{figure}\renewcommand {\baselinestretch}{1}\small\listing {1}
&lt;?xml versio...
.../html&gt;
&lt;/bl:template&gt;\renewcommand {\baselinestretch}{2}\endlisting \end{figure}"></TD></TR>
</TABLE>
</DIV><P></P>

<P>

<H1><A NAME="SECTION00020000000000000000"></A>
<A NAME="sec-etl"></A><BR>
2  Extensible Templating Language
</H1>

<P>
An ETL template must be well-formed XML that is valid with respect
to the language's XML Schema Definitions.  This requirement catches a
large class of programming errors very early in the development
process without need for the ETL compiler at all.  Those schemas
are also used to support syntax coloring and completion of element and
attribute names.  ETL templates are processed within the context of
an HTTP request and generate an HTTP
response (including the markup document and headers).

<P>
ETL supports dynamic behaviours by means of <I>primitives</I> which
are elements in the <FONT SIZE="-1"><TT>bl:*</TT></FONT> namespace.  Primitives either output text
to the current destination stream (initially the response document) or
perform some side-effect (or both).  For example the <FONT SIZE="-1"><TT>bl:set</TT></FONT>
primitive assigns a variable a value without outputting any text,
while the <FONT SIZE="-1"><TT>bl:http</TT></FONT> primitive outputs either <FONT SIZE="-1"><TT>http</TT></FONT>
or <FONT SIZE="-1"><TT>https</TT></FONT> based on whether the current request is secure.
The behaviour of a primitive is controlled by its attributes.  Some
primitives (e.g., <FONT SIZE="-1"><TT>http</TT></FONT>) are always empty while others are
allowed to be non-empty and control the contained elements.
For example, in:

<P>
<PRE>
&lt;bl:if var="showcopyright"&gt; (C) 2002 &lt;/bl:if&gt;
</PRE>

<P>
the contents of the <FONT SIZE="-1"><TT>bl:if</TT></FONT> are output if and
only if the variable's value is non-empty.

<P>
Many primitives derive their arguments not from individual attributes
but from pairs of attributes that are together called a <I>slot</I>.
For example, the <FONT SIZE="-1"><TT>bl:cr</TT></FONT> directive outputs a number of
linefeeds determined by a slot called <FONT SIZE="-1"><TT>count</TT></FONT> 
which is specified by the mutually-exclusive attributes <FONT SIZE="-1"><TT>count</TT></FONT> and
<FONT SIZE="-1"><TT>count-var</TT></FONT>.  The <FONT SIZE="-1"><TT>count</TT></FONT> attribute has type
<FONT SIZE="-1"><TT>xsd:integer</TT></FONT> and is used to provide a literal integer
argument to the primitive.  In contrast, the <FONT SIZE="-1"><TT>count-var</TT></FONT>
attribute has type <FONT SIZE="-1"><TT>xsd:string</TT></FONT> and names a variable to
evaluate at runtime.  In both cases, the resulting value is used as
the number of linefeeds to generate, but for <FONT SIZE="-1"><TT>@count</TT></FONT> that
number is set statically while for <FONT SIZE="-1"><TT>@count-var</TT></FONT> it is
determined dynamically.  Other primitives include <FONT SIZE="-1"><TT>uri</TT></FONT>,
<FONT SIZE="-1"><TT>redir</TT></FONT>, and <FONT SIZE="-1"><TT>set-cookie</TT></FONT>.

<P>
As with all imperative programming languages, ETL has the notion of
variables that store values. Variables are assigned values (determined
by executing the contained elements) using the
<FONT SIZE="-1"><TT>bl:set</TT></FONT> primitive:

<P>
<PRE>
&lt;bl:set var="baseuri"&gt;&lt;bl:http/&gt;://&lt;bl:get
 var="hostname"/&gt;/&lt;/bl:set&gt;
</PRE>

<P>
After assignment, values are retrieved by referencing them by name in
a slot or by copying them directly to the output stream using
<FONT SIZE="-1"><TT>bl:get</TT></FONT>.  There are numerous special reserved variables that may have
side-effects and expose system-level details or request parameters such as <FONT SIZE="-1"><TT>#browsertype</TT></FONT>.
Various other data are accessible to ETL templates via
<I>buckets</I>. Buckets replace field references and accessor methods of
distinguished objects in languages such as Java.  For example, where a
JSP developer might write <FONT SIZE="-1"><TT>&lt;%= request.getHeader("User-Agent") %&gt;</TT></FONT>
the ETL developer accesses the <FONT SIZE="-1"><TT>#http</TT></FONT>
bucket instead:

<P>
<PRE>
&lt;bl:get var="#http/User-Agent"/&gt;
</PRE>

<P>
A <I>transformer</I> is a streaming converter from one byte sequence
to another.  For example, the <FONT SIZE="-1"><TT>url-encode</TT></FONT> transformer
converts ``hello world'' into ``hello+world''.  Transformers can be
used whenever a variable is being set (via
<FONT SIZE="-1"><TT>bl:set</TT></FONT>) or accessed (via <FONT SIZE="-1"><TT>bl:get</TT></FONT>) using the
<FONT SIZE="-1"><TT>transform</TT></FONT> attribute which specifies an ordered 
list of transformers to apply.  For example:

<P>
<PRE>
&lt;bl:get var="a" transform="trim urlencode"/&gt;
</PRE>

<P>
results in writing out the value of the variable <FONT SIZE="-1"><TT>a</TT></FONT>
after first eliminating leading and trailing whitespace and then
URL-encoding the resulting trimmed string.

<P>
There are five primary means of control flow in ETL: 1)
<I>template selection</I> dispatches to the most specific template on
the basis of the current cobrand; 2) <I>conditionals</I> include
<FONT SIZE="-1"><TT>bl:if</TT></FONT> and <FONT SIZE="-1"><TT>bl:choose</TT></FONT>/<FONT SIZE="-1"><TT>bl:when</TT></FONT>; 3)
<I>loops</I> are allowed but are all data-driven or explicitly bounded; 
4) <I>exceptions</I> transfer control non-locally; and 5) <I>remote
invocations</I> allow calling other web services as subroutines.

<P>
<I>Literal markup elements</I> are copied directly to the response
stream from the source template.  We support the common need to
conditionally include a tag by using a special
<FONT SIZE="-1"><TT>bl:if-var</TT></FONT> attribute on an arbitrary literal result element:

<P>
<PRE>
&lt;b bl:if-var="#pro/wantbold"&gt;text&lt;/b&gt;
</PRE>

<P>
where the output of <I>both</I> the open and close
<FONT SIZE="-1"><TT>b</TT></FONT> tags is controlled by the test of the single variable
(and the contents of the <FONT SIZE="-1"><TT>b</TT></FONT> element are always
executed). This technique also lets us factor out the guard, thus
eliminating the possibility of a mismatch between the test used for
the start tag and the one used for the end tag.

<P>
ETL permits fine-grained control over the <I>whitespace</I> that is
meaningful via two orthogonal special attributes that are allowed on
every XML element in source ETL documents:
<FONT SIZE="-1"><TT>@bl:space-nodes</TT></FONT> and <FONT SIZE="-1"><TT>@bl:text-nodes</TT></FONT>.  These
attributes are inherited by child elements and their contents unless
overridden.

<P>
<I>Custom tags</I> define new abstractions in terms of 
built-in primitives using an XSLT transformation rule.  Those
rules are applied to subtrees of the source template and rewrite
that code to contain only the core language.  This approach allows a
great deal of flexibility in new abstractions without compromising our
tight control over the limited behaviour we permit the presentation
layer.

<P>
A byte-code compiler and runtime for the Extensible Templating
Language is an integral part of InfoSpace's ETL Server,
an ISAPI extension to IIS.  The server supports configuration 
via special <FONT SIZE="-1"><TT>admin</TT></FONT> primitives, has a powerful
HTTP-based reflection interface, and understands various special
<FONT SIZE="-1"><TT>etl-*</TT></FONT> URL parameters that help with debugging (e.g., 
<FONT SIZE="-1"><TT>etl-decompile</TT></FONT> dumps a template's byte-codes
instead of running it).  InfoSpace's production web tree
contains over sixty thousand ETL templates and the clusters of
ETL Servers serve millions of requests per day.

<P>

<H1><A NAME="SECTION00030000000000000000"></A>
<A NAME="sec-related-work"></A><BR>
3 Related work &amp; conclusion
</H1>

<P>
LAML has similar goals to ETL, but takes an opposite approach: LAML
embeds the simpler markup languages in Scheme, an especially powerful
and expressive language.  <code>&lt;bigwig&gt;</code> is another significant
research project that has similar goals.  That work adds a first class
markup-fragment type to a conventional programming language.  That
system is more aggressive in its verification of the well-formedness
of markup values: an iterative data-flow analysis bounds the possible
values which can then be confirmed to be valid.

<P>
The Extensible Templating Language leverages a domain-specific
XML-based programming language intermingled with literal markup.  By
restricting the language, we preserve a better separation of front-
and back-ends. By using XML, we simplify analyses, transformations,
and make it easier to build supporting tools.  The static checks ETLS
performs reduce the need for testing and make development faster and
less error-prone.

<P>

<H2><A NAME="SECTION00040000000000000000">
Bibliography</A>
</H2><DL COMPACT><DD><P></P><DT><A NAME="Badros-www9">1</A>
<DD>
G.&nbsp;J. Badros.
<BR>JavaML: A markup language for Java source code.
<BR>In <EM>Proc. of the Ninth Intl. Conf. on the World Wide Web</EM>,
  Amsterdam, May 2000. Elsevier Science B. V.
<BR><TT><A NAME="tex2html5"
  HREF="http://www.cs.washington.edu/homes/gjb/JavaML">http://www.cs.washington.edu/homes/gjb/JavaML</A></TT>.

<P></P><DT><A NAME="ETL-full">2</A>
<DD>
G.&nbsp;J. Badros.
<BR>The Extensible Templating Language: An XML-based restricted
  markup-generating language, November 2002.
<BR><TT><A NAME="tex2html6"
  HREF="http://www.cs.washington.edu/homes/gjb/papers/etl-full.pdf">http://www.cs.washington.edu/homes/gjb/papers/etl-full.pdf</A></TT>.
</DL>

<P>

<H1><A NAME="SECTION00050000000000000000">
About this document ...</A>
</H1>
 <STRONG>The Extensible Templating Language: 
<BR>       An XML-based Restricted Markup-Generating Language<BR></STRONG><P>
This document was generated using the
<A HREF="http://www-dsed.llnl.gov/files/programs/unix/latex2html/manual/"><STRONG>LaTeX</STRONG>2<tt>HTML</tt></A> translator Version 99.2beta8 (1.46)
<P>
Copyright &#169; 1993, 1994, 1995, 1996,
<A HREF="http://cbl.leeds.ac.uk/nikos/personal.html">Nikos Drakos</A>, 
Computer Based Learning Unit, University of Leeds.
<BR>Copyright &#169; 1997, 1998, 1999,
<A HREF="http://www.maths.mq.edu.au/~ross/">Ross Moore</A>, 
Mathematics Department, Macquarie University, Sydney.
<P>
The command line arguments were: <BR>
 <STRONG>latex2html</STRONG> <TT>-split 0 -no_navigation -show_section_numbers etl-www2003-poster.tex</TT>
<P>
The translation was initiated by Greg Badros on 2003-03-21<BR><HR><H4>Footnotes</H4>
<DL>
<DT><A NAME="foot186">... Language</A><A NAME="foot186"
 HREF="etl-www2003-poster.html#tex2html3"><SUP><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]"
 SRC="file:/opt/lib/latex2html/icons/footnote.png"></SUP></A>
<DD>This research is supported by
InfoSpace's advanced server development group.  ETL and ETLS are
trademarks of InfoSpace, Inc.

</DL><BR><HR>
<ADDRESS>
Greg Badros
2003-03-21
</ADDRESS>
</BODY>
</HTML>
